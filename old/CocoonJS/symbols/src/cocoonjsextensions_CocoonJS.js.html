<html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"> <style>
	.KEYW {color: #933;}
	.COMM {color: #bbb; font-style: italic;}
	.NUMB {color: #393;}
	.STRN {color: #393;}
	.REGX {color: #339;}
	.line {border-right: 1px dotted #666; color: #666; font-style: normal;}
	</style></head><body><pre><span class='line'>  1</span> <span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>  2</span> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>  3</span> </span><span class="WHIT">	</span><span class="COMM">// There should not be a CocoonJS object when this code is executed.</span><span class="WHIT">
<span class='line'>  4</span> </span><span class="WHIT">	</span><span class="COMM">// if (typeof window.CocoonJS !== 'undefined') throw("This is strange, a CocoonJS object already exists when trying to create it.");</span><span class="WHIT">
<span class='line'>  5</span> 
<span class='line'>  6</span> </span><span class="WHIT">    </span><span class="COMM">/**
<span class='line'>  7</span>     * The basic object for all the CocoonJS related specific APIs === extensions.
<span class='line'>  8</span>     * @namespace
<span class='line'>  9</span>     */</span><span class="WHIT">
<span class='line'> 10</span> </span><span class="WHIT">    </span><span class="NAME">CocoonJS</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">window.CocoonJS</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">window.CocoonJS</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 11</span> 
<span class='line'> 12</span> </span><span class="WHIT">	</span><span class="NAME">CocoonJS.nativeExtensionObjectAvailable</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">window.ext</span><span class="WHIT"> </span><span class="PUNC">!==</span><span class="WHIT"> </span><span class="STRN">'undefined'</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 13</span> 
<span class='line'> 14</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'> 15</span> 	* This type represents a 2D size structure with horizontal and vertical values.
<span class='line'> 16</span> 	* @namespace
<span class='line'> 17</span> 	*/</span><span class="WHIT">
<span class='line'> 18</span> </span><span class="WHIT">	</span><span class="NAME">CocoonJS.Size</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 19</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'> 20</span> 		* The horizontal size value.
<span class='line'> 21</span> 		*/</span><span class="WHIT">
<span class='line'> 22</span> </span><span class="WHIT">		</span><span class="NAME">width</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'> 23</span> 
<span class='line'> 24</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'> 25</span> 		* The vertical size value.
<span class='line'> 26</span> 		*/</span><span class="WHIT">
<span class='line'> 27</span> </span><span class="WHIT">		</span><span class="NAME">height</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT">
<span class='line'> 28</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 29</span> 
<span class='line'> 30</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'> 31</span> 	* This utility function allows to create an object oriented like hierarchy between two functions using their prototypes.
<span class='line'> 32</span> 	* This function adds a "superclass" and a "__super" attributes to the subclass and it's functions to reference the super class.
<span class='line'> 33</span> 	* @param {function} subc The subclass function.
<span class='line'> 34</span> 	* @param {function} superc The superclass function.
<span class='line'> 35</span> 	*/</span><span class="WHIT">
<span class='line'> 36</span> </span><span class="WHIT">	</span><span class="NAME">CocoonJS.extend</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">subc</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">superc</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 37</span> </span><span class="WHIT">	    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">subcp</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">subc.prototype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 38</span> 
<span class='line'> 39</span> </span><span class="WHIT">	    </span><span class="COMM">// Class pattern.</span><span class="WHIT">
<span class='line'> 40</span> </span><span class="WHIT">	    </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">CocoonJSExtendHierarchyChainClass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 41</span> </span><span class="WHIT">	    </span><span class="NAME">CocoonJSExtendHierarchyChainClass.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">superc.prototype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 42</span> 
<span class='line'> 43</span> </span><span class="WHIT">	    </span><span class="NAME">subc.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">CocoonJSExtendHierarchyChainClass</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">       </span><span class="COMM">// chain prototypes.</span><span class="WHIT">
<span class='line'> 44</span> </span><span class="WHIT">	    </span><span class="NAME">subc.superclass</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">superc.prototype</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 45</span> </span><span class="WHIT">	    </span><span class="NAME">subc.prototype.constructor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">subc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 46</span> 
<span class='line'> 47</span> </span><span class="WHIT">	    </span><span class="COMM">// Reset constructor. See Object Oriented Javascript for an in-depth explanation of this.</span><span class="WHIT">
<span class='line'> 48</span> </span><span class="WHIT">	    </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">superc.prototype.constructor</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">Object.prototype.constructor</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 49</span> </span><span class="WHIT">	        </span><span class="NAME">superc.prototype.constructor</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">superc</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 50</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 51</span> 
<span class='line'> 52</span> </span><span class="WHIT">	    </span><span class="COMM">// Check all the elements in the subclass prototype and add them to the chain object's prototype.</span><span class="WHIT">
<span class='line'> 53</span> </span><span class="WHIT">	    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">method</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">subcp</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 54</span> </span><span class="WHIT">	        </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">subcp.hasOwnProperty</span><span class="PUNC">(</span><span class="NAME">method</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 55</span> </span><span class="WHIT">	            </span><span class="NAME">subc.prototype</span><span class="PUNC">[</span><span class="NAME">method</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">subcp</span><span class="PUNC">[</span><span class="NAME">method</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'> 56</span> 
<span class='line'> 57</span> </span><span class="WHIT">	            </span><span class="COMM">// // tenemos en super un metodo con igual nombre.</span><span class="WHIT">
<span class='line'> 58</span> </span><span class="WHIT">	            </span><span class="COMM">// if ( superc.prototype[method]) </span><span class="WHIT">
<span class='line'> 59</span> </span><span class="WHIT">	            </span><span class="COMM">// {</span><span class="WHIT">
<span class='line'> 60</span> </span><span class="WHIT">	            </span><span class="COMM">//     subc.prototype[method]= (function(fn, fnsuper) </span><span class="WHIT">
<span class='line'> 61</span> </span><span class="WHIT">	            </span><span class="COMM">//     {</span><span class="WHIT">
<span class='line'> 62</span> </span><span class="WHIT">	            </span><span class="COMM">//         return function() </span><span class="WHIT">
<span class='line'> 63</span> </span><span class="WHIT">	            </span><span class="COMM">//         {</span><span class="WHIT">
<span class='line'> 64</span> </span><span class="WHIT">	            </span><span class="COMM">//             var prevMethod= this.__super;</span><span class="WHIT">
<span class='line'> 65</span> 
<span class='line'> 66</span> </span><span class="WHIT">	            </span><span class="COMM">//             this.__super= fnsuper;</span><span class="WHIT">
<span class='line'> 67</span> 
<span class='line'> 68</span> </span><span class="WHIT">	            </span><span class="COMM">//             var retValue= fn.apply(</span><span class="WHIT">
<span class='line'> 69</span> </span><span class="WHIT">	            </span><span class="COMM">//                     this,</span><span class="WHIT">
<span class='line'> 70</span> </span><span class="WHIT">	            </span><span class="COMM">//                     Array.prototype.slice.call(arguments) );</span><span class="WHIT">
<span class='line'> 71</span> 
<span class='line'> 72</span> </span><span class="WHIT">	            </span><span class="COMM">//             this.__super= prevMethod;</span><span class="WHIT">
<span class='line'> 73</span> 
<span class='line'> 74</span> </span><span class="WHIT">	            </span><span class="COMM">//             return retValue;</span><span class="WHIT">
<span class='line'> 75</span> </span><span class="WHIT">	            </span><span class="COMM">//         };</span><span class="WHIT">
<span class='line'> 76</span> </span><span class="WHIT">	            </span><span class="COMM">//     })(subc.prototype[method], superc.prototype[method]);</span><span class="WHIT">
<span class='line'> 77</span> </span><span class="WHIT">	            </span><span class="COMM">// }</span><span class="WHIT">
<span class='line'> 78</span> </span><span class="WHIT">	        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 79</span> </span><span class="WHIT">	    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 80</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'> 81</span> 
<span class='line'> 82</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'> 83</span> 	* IMPORTANT: This function should only be used by Ludei.
<span class='line'> 84</span> 	* This function allows a call to the native extension object function reusing the same arguments object.
<span class='line'> 85</span> 	* Why is interesting to use this function instead of calling the native object's function directly?
<span class='line'> 86</span> 	* As the CocoonJS object functions expicitly receive parameters, if they are not present and the native call is direcly mapped,
<span class='line'> 87</span> 	* undefined arguments are passed to the native side. Some native functions do not check the parameters validation
<span class='line'> 88</span> 	* correctly (just check the number of parameters passed).
<span class='line'> 89</span> 	* Another solution instead of using this function call is to correctly check if the parameters are valid (not undefined) to make the
<span class='line'> 90</span> 	* call, but it takes more work than using this approach.
<span class='line'> 91</span> 	* @static
<span class='line'> 92</span> 	* @param {string} nativeExtensionObjectName The name of the native extension object name. The object that is a member of the 'ext' object.
<span class='line'> 93</span> 	* @param {string} nativeFunctionName The name of the function to be called inside the native extension object.
<span class='line'> 94</span> 	* @param {object} arguments The arguments object of the CocoonJS extension object function. It contains all the arguments passed to the CocoonJS extension object function and these are the ones that will be passed to the native call too.
<span class='line'> 95</span> 	* @param {boolean} [async] A flag to indicate if the makeCall (false or undefined) or the makeCallAsync function should be used to perform the native call.
<span class='line'> 96</span> 	* @returns Whatever the native function call returns.
<span class='line'> 97</span> 	*/</span><span class="WHIT">
<span class='line'> 98</span> </span><span class="WHIT">	</span><span class="NAME">CocoonJS.makeNativeExtensionObjectFunctionCall</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nativeExtensionObjectName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nativeFunctionName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">args</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">async</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'> 99</span> </span><span class="WHIT">		</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">CocoonJS.nativeExtensionObjectAvailable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>100</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">argumentsArray</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array.prototype.slice.call</span><span class="PUNC">(</span><span class="NAME">args</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>101</span> </span><span class="WHIT">			</span><span class="NAME">argumentsArray.unshift</span><span class="PUNC">(</span><span class="NAME">nativeFunctionName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>102</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">nativeExtensionObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ext</span><span class="PUNC">[</span><span class="NAME">nativeExtensionObjectName</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>103</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">makeCallFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">async</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">nativeExtensionObject.makeCallAsync</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">nativeExtensionObject.makeCall</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>104</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">makeCallFunction.apply</span><span class="PUNC">(</span><span class="NAME">nativeExtensionObject</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">argumentsArray</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>105</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">finalRet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>106</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">typeof</span><span class="WHIT"> </span><span class="NAME">ret</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="STRN">"string"</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>107</span> </span><span class="WHIT">				</span><span class="KEYW">try</span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>108</span> </span><span class="WHIT">					</span><span class="NAME">finalRet</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">JSON.parse</span><span class="PUNC">(</span><span class="NAME">ret</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>109</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>110</span> </span><span class="WHIT">				</span><span class="KEYW">catch</span><span class="PUNC">(</span><span class="NAME">error</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>111</span> </span><span class="WHIT">				</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>112</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>113</span> </span><span class="WHIT">			</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">finalRet</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>114</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>115</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>116</span> 
<span class='line'>117</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>118</span> 	* Returns an object retrieved from a path specified by a dot specified text path starting from a given base object.
<span class='line'>119</span> 	* It could be useful to find the reference of an object from a defined base object. For example the base object could be window and the
<span class='line'>120</span> 	* path could be "CocoonJS.App" or "document.body".
<span class='line'>121</span> 	* @param {Object} baseObject The object to start from to find the object using the given text path.
<span class='line'>122</span> 	* @param {string} objectPath The path in the form of a text using the dot notation. i.e. "document.body"
<span class='line'>123</span> 	* For example:
<span class='line'>124</span> 	* var body = getObjectFromPath(window, "document.body");
<span class='line'>125</span> 	*/</span><span class="WHIT">
<span class='line'>126</span> </span><span class="WHIT">	</span><span class="NAME">CocoonJS.getObjectFromPath</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">baseObject</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">objectPath</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>127</span> </span><span class="WHIT">    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">parts</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">objectPath.split</span><span class="PUNC">(</span><span class="STRN">'.'</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>128</span> </span><span class="WHIT">    	</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">baseObject</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>129</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">len</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">parts.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">len</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">++</span><span class="NAME">i</span><span class="PUNC">)</span><span class="WHIT"> 
<span class='line'>130</span>         </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>131</span> </span><span class="WHIT">            </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">||</span><span class="WHIT"> </span><span class="NAME">undefined</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>132</span> </span><span class="WHIT">    		</span><span class="NAME">obj</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">[</span><span class="NAME">parts</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>133</span> </span><span class="WHIT">    	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>134</span> </span><span class="WHIT">    	</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">obj</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>135</span> </span><span class="WHIT"> 	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>136</span> 
<span class='line'>137</span> </span><span class="WHIT"> 	</span><span class="COMM">/**
<span class='line'>138</span>  	* Returns the key for a value in a dictionary. It looks for an specific value inside a dictionary and returns the corresponding key.
<span class='line'>139</span>  	* @param {Object} dictionary The dictionary to look for the value in and get the corresponding key.
<span class='line'>140</span>  	* @param {Object} value The value to look for inside the dictionary and return it's corresponding key.
<span class='line'>141</span>  	* @return The key that corresponds to the given value it is has been found or null.
<span class='line'>142</span>  	*/</span><span class="WHIT">
<span class='line'>143</span> </span><span class="WHIT"> 	</span><span class="NAME">CocoonJS.getKeyForValueInDictionary</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">dictionary</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>144</span> </span><span class="WHIT">        </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">finalKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>145</span> </span><span class="WHIT">        </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">key</span><span class="WHIT"> </span><span class="KEYW">in</span><span class="WHIT"> </span><span class="NAME">dictionary</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>146</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">dictionary</span><span class="PUNC">[</span><span class="NAME">key</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">===</span><span class="WHIT"> </span><span class="NAME">value</span><span class="PUNC">)</span><span class="WHIT">            </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>147</span> </span><span class="WHIT">                </span><span class="NAME">finalKey</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">key</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>148</span> </span><span class="WHIT">                </span><span class="KEYW">break</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>149</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>150</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>151</span> </span><span class="WHIT">        </span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">finalKey</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>152</span> </span><span class="WHIT"> 	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>153</span> 
<span class='line'>154</span> </span><span class="WHIT"> 	</span><span class="COMM">/**
<span class='line'>155</span>  	* Finds a string inside a given array of strings by looking for a given substring. It can also
<span class='line'>156</span>  	* specify if the search must be performed taking care or not of the case sensitivity.
<span class='line'>157</span>  	* @param {Array} stringArray The array of strings in which to to look for the string.
<span class='line'>158</span>  	* @param {string} subString The substring to look for inside all the strings of the array.
<span class='line'>159</span>  	* @param {boolean} caseSensitive A flag to indicate if the search must be performed taking case of the 
<span class='line'>160</span>  	* case sensitiveness (true) or not (false).
<span class='line'>161</span>  	* @return {string} The string that has been found or null if the substring is not inside any of the string of the array.
<span class='line'>162</span>  	*/</span><span class="WHIT">
<span class='line'>163</span> </span><span class="WHIT"> 	</span><span class="NAME">CocoonJS.findStringInStringArrayThatIsIndexOf</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">stringArray</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">subString</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">caseSensitive</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>164</span> </span><span class="WHIT"> 		</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">foundString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>165</span> </span><span class="WHIT"> 		</span><span class="NAME">subString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">caseSensitive</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">subString</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">subString.toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>166</span> </span><span class="WHIT"> 		</span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">foundString</span><span class="WHIT"> </span><span class="PUNC">==</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">stringArray.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT">	</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>167</span> </span><span class="WHIT"> 			</span><span class="NAME">foundString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">caseSensitive</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">stringArray</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NAME">stringArray</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">toUpperCase</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>168</span> </span><span class="WHIT"> 			</span><span class="NAME">foundString</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">foundString.indexOf</span><span class="PUNC">(</span><span class="NAME">subString</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="WHIT"> </span><span class="PUNC">?</span><span class="WHIT"> </span><span class="NAME">stringArray</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">null</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>169</span>  		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>170</span> </span><span class="WHIT"> 		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="NAME">foundString</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>171</span> </span><span class="WHIT"> 	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>172</span> 
<span class='line'>173</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>174</span> 	* A class that represents objects to handle events. Event handlers have always the same structure:
<span class='line'>175</span> 	* Mainly they provide the addEventListener and removeEventListener functions.
<span class='line'>176</span> 	* Both functions receive a callback function that will be added or removed. All the added callback
<span class='line'>177</span> 	* functions will be called when the event takes place.
<span class='line'>178</span> 	* Additionally they also allow the addEventListenerOnce and notifyEventListeners functions.
<span class='line'>179</span> 	* @constructor
<span class='line'>180</span> 	* @param {string} nativeExtensionObjectName The name of the native extension object (inside the ext object) to be used.
<span class='line'>181</span> 	* @param {string} cocoonJSExtensionObjectName The name of the sugarized extension object.
<span class='line'>182</span> 	* @param {string} nativeEventName The name of the native event inside the ext object.
<span class='line'>183</span> 	* @param {number} [chainFunction] An optional function used to preprocess the listener callbacks. This function, if provided,
<span class='line'>184</span> 	* will be called before any of the other listeners.
<span class='line'>185</span> 	*/</span><span class="WHIT">
<span class='line'>186</span> </span><span class="WHIT">	</span><span class="NAME">CocoonJS.EventHandler</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">nativeExtensionObjectName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cocoonJSExtensionObjectName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">nativeEventName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">chainFunction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>187</span> </span><span class="WHIT">		</span><span class="NAME">this.listeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>188</span> </span><span class="WHIT">		</span><span class="NAME">this.listenersOnce</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>189</span> </span><span class="WHIT">		</span><span class="NAME">this.chainFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">chainFunction</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>190</span> 
<span class='line'>191</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>192</span> 		* Adds a callback function so it can be called when the event takes place.
<span class='line'>193</span> 		* @param {function} listener The callback function to be added to the event handler object. See the referenced Listener function documentation for more detail in each event handler object's documentation.
<span class='line'>194</span> 		*/</span><span class="WHIT">
<span class='line'>195</span> </span><span class="WHIT">		</span><span class="NAME">this.addEventListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>196</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">chainFunction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>197</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>198</span> </span><span class="WHIT">					</span><span class="NAME">chainFunction.call</span><span class="PUNC">(</span><span class="KEYW">this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">arguments.callee.sourceListener</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">Array.prototype.slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> 
<span class='line'>199</span> 				</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>200</span> </span><span class="WHIT">				</span><span class="NAME">listener.CocoonJSEventHandlerChainFunction</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>201</span> </span><span class="WHIT">				</span><span class="NAME">f.sourceListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>202</span> </span><span class="WHIT">				</span><span class="NAME">listener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>203</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>204</span> 
<span class='line'>205</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cocoonJSExtensionObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">CocoonJS.getObjectFromPath</span><span class="PUNC">(</span><span class="NAME">CocoonJS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cocoonJSExtensionObjectName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>206</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cocoonJSExtensionObject</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">cocoonJSExtensionObject.nativeExtensionObjectAvailable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>207</span> </span><span class="WHIT">                </span><span class="NAME">ext</span><span class="PUNC">[</span><span class="NAME">nativeExtensionObjectName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addEventListener</span><span class="PUNC">(</span><span class="NAME">nativeEventName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>208</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>209</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>210</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">indexOfListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.listeners.indexOf</span><span class="PUNC">(</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>211</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexOfListener</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>212</span> </span><span class="WHIT">                	</span><span class="NAME">this.listeners.push</span><span class="PUNC">(</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>213</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>214</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>215</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>216</span> 
<span class='line'>217</span> </span><span class="WHIT">        </span><span class="NAME">this.addEventListenerOnce</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>218</span> </span><span class="WHIT">		</span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>219</span> </span><span class="WHIT">			</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">chainFunction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>220</span> </span><span class="WHIT">				</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">f</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT"> </span><span class="NAME">chainFunction</span><span class="PUNC">(</span><span class="NAME">arguments.callee.sourceListener</span><span class="PUNC">,</span><span class="NAME">Array.prototype.slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>221</span> </span><span class="WHIT">				</span><span class="NAME">f.sourceListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>222</span> </span><span class="WHIT">				</span><span class="NAME">listener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">f</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>223</span> </span><span class="WHIT">			</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>224</span> 
<span class='line'>225</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cocoonJSExtensionObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">CocoonJS.getObjectFromPath</span><span class="PUNC">(</span><span class="NAME">CocoonJS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cocoonJSExtensionObjectName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>226</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cocoonJSExtensionObject.nativeExtensionObjectAvailable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>227</span> </span><span class="WHIT">                </span><span class="NAME">ext</span><span class="PUNC">[</span><span class="NAME">nativeExtensionObjectName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">addEventListenerOnce</span><span class="PUNC">(</span><span class="NAME">nativeEventName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>228</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>229</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT">
<span class='line'>230</span> </span><span class="WHIT">            </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>231</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">indexOfListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.listeners.indexOf</span><span class="PUNC">(</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>232</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexOfListener</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT">
<span class='line'>233</span> </span><span class="WHIT">                </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>234</span> </span><span class="WHIT">                	</span><span class="NAME">this.listenersOnce.push</span><span class="PUNC">(</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>235</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>236</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>237</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>238</span> 
<span class='line'>239</span> </span><span class="WHIT">        </span><span class="COMM">/**
<span class='line'>240</span>          * Removes a callback function that was added to the event handler so it won't be called when the event takes place.
<span class='line'>241</span>          * @param {function} listener The callback function to be removed from the event handler object. See the referenced Listener function documentation for more detail in each event handler object's documentation.
<span class='line'>242</span>          */</span><span class="WHIT">
<span class='line'>243</span> </span><span class="WHIT">        </span><span class="NAME">this.removeEventListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>244</span> 
<span class='line'>245</span> </span><span class="WHIT">        	</span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">chainFunction</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>246</span> </span><span class="WHIT">        		</span><span class="NAME">listener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">listener.CocoonJSEventHandlerChainFunction</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>247</span> </span><span class="WHIT">        		</span><span class="KEYW">delete</span><span class="WHIT"> </span><span class="NAME">listener.CocoonJSEventHandlerChainFunction</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>248</span> </span><span class="WHIT">        	</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>249</span> 
<span class='line'>250</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cocoonJSExtensionObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">CocoonJS.getObjectFromPath</span><span class="PUNC">(</span><span class="NAME">CocoonJS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cocoonJSExtensionObjectName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>251</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cocoonJSExtensionObject.nativeExtensionObjectAvailable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>252</span> </span><span class="WHIT">                </span><span class="NAME">ext</span><span class="PUNC">[</span><span class="NAME">nativeExtensionObjectName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">removeEventListener</span><span class="PUNC">(</span><span class="NAME">nativeEventName</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>253</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>254</span> </span><span class="WHIT">            </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>255</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">indexOfListener</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.listeners.indexOf</span><span class="PUNC">(</span><span class="NAME">listener</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>256</span> </span><span class="WHIT">                </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">indexOfListener</span><span class="WHIT"> </span><span class="PUNC">>=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>257</span> </span><span class="WHIT">                    </span><span class="NAME">this.listeners.splice</span><span class="PUNC">(</span><span class="NAME">indexOfListener</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">1</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>258</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>259</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>260</span> </span><span class="WHIT">        </span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>261</span> 
<span class='line'>262</span> </span><span class="WHIT">		</span><span class="NAME">this.notifyEventListeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>263</span> </span><span class="WHIT">			</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">cocoonJSExtensionObject</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">CocoonJS.getObjectFromPath</span><span class="PUNC">(</span><span class="NAME">CocoonJS</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">cocoonJSExtensionObjectName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>264</span> </span><span class="WHIT">            </span><span class="KEYW">if</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="NAME">cocoonJSExtensionObject</span><span class="WHIT"> </span><span class="PUNC">&&</span><span class="WHIT"> </span><span class="NAME">cocoonJSExtensionObject.nativeExtensionObjectAvailable</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>265</span> </span><span class="WHIT">                </span><span class="NAME">ext</span><span class="PUNC">[</span><span class="NAME">nativeExtensionObjectName</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">notifyEventListeners</span><span class="PUNC">(</span><span class="NAME">nativeEventName</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>266</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT"> </span><span class="KEYW">else</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>267</span> 
<span class='line'>268</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">argumentsArray</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array.prototype.slice.call</span><span class="PUNC">(</span><span class="NAME">arguments</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>269</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">listeners</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT">     </span><span class="NAME">Array.prototype.slice.call</span><span class="PUNC">(</span><span class="NAME">this.listeners</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>270</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">listenersOnce</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">Array.prototype.slice.call</span><span class="PUNC">(</span><span class="NAME">this.listenersOnce</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>271</span> </span><span class="WHIT">                </span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">_this</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>272</span> </span><span class="WHIT">                </span><span class="COMM">// Notify listeners after a while ;) === do not block this thread.</span><span class="WHIT">
<span class='line'>273</span> </span><span class="WHIT">                </span><span class="NAME">setTimeout</span><span class="PUNC">(</span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>274</span> </span><span class="WHIT">                    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">listeners.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>275</span> </span><span class="WHIT">                        </span><span class="NAME">listeners</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="NAME">_this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">argumentsArray</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>276</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>277</span> </span><span class="WHIT">                    </span><span class="KEYW">for</span><span class="WHIT"> </span><span class="PUNC">(</span><span class="KEYW">var</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="WHIT"> </span><span class="PUNC">&lt;</span><span class="WHIT"> </span><span class="NAME">listenersOnce.length</span><span class="PUNC">;</span><span class="WHIT"> </span><span class="NAME">i</span><span class="PUNC">++</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>278</span> </span><span class="WHIT">                        </span><span class="NAME">listenersOnce</span><span class="PUNC">[</span><span class="NAME">i</span><span class="PUNC">]</span><span class="PUNC">.</span><span class="NAME">apply</span><span class="PUNC">(</span><span class="NAME">_this</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NAME">argumentsArray</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>279</span> </span><span class="WHIT">                    </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>280</span> </span><span class="WHIT">                </span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>281</span> 
<span class='line'>282</span> </span><span class="WHIT">                </span><span class="NAME">_this.listenersOnce</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">[</span><span class="PUNC">]</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>283</span> </span><span class="WHIT">            </span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>284</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>285</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>286</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>287</span> 
<span class='line'>288</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>289</span> 	* A simple timer class. Update it every loop iteration and get values from accumulated time to elapsed time in seconds or milliseconds.
<span class='line'>290</span> 	*/</span><span class="WHIT">
<span class='line'>291</span> </span><span class="WHIT">	</span><span class="NAME">CocoonJS.Timer</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>292</span> </span><span class="WHIT">		</span><span class="NAME">this.reset</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>293</span> </span><span class="WHIT">		</span><span class="KEYW">return</span><span class="WHIT"> </span><span class="KEYW">this</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>294</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>295</span> 
<span class='line'>296</span> </span><span class="WHIT">	</span><span class="NAME">CocoonJS.Timer.prototype</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>297</span> </span><span class="WHIT">		</span><span class="NAME">currentTimeInMillis</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>298</span> </span><span class="WHIT">		</span><span class="NAME">lastTimeInMillis</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>299</span> </span><span class="WHIT">		</span><span class="NAME">elapsedTimeInMillis</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>300</span> </span><span class="WHIT">		</span><span class="NAME">elapsedTimeInSeconds</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>301</span> </span><span class="WHIT">		</span><span class="NAME">accumTimeInMillis</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>302</span> 
<span class='line'>303</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>304</span> 		Resets the timer to 0.
<span class='line'>305</span> 		*/</span><span class="WHIT">
<span class='line'>306</span> </span><span class="WHIT">		</span><span class="NAME">reset</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>307</span> </span><span class="WHIT">			</span><span class="NAME">this.currentTimeInMillis</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.lastTimeInMillis</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>308</span> </span><span class="WHIT">			</span><span class="NAME">this.accumTimeInMillis</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.elapsedTimeInMillis</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.elapsedTimeInSeconds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NUMB">0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>309</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="PUNC">,</span><span class="WHIT">
<span class='line'>310</span> 
<span class='line'>311</span> </span><span class="WHIT">		</span><span class="COMM">/**
<span class='line'>312</span> 		Updates the timer calculating the elapsed time between update calls.
<span class='line'>313</span> 		*/</span><span class="WHIT">
<span class='line'>314</span> </span><span class="WHIT">		</span><span class="NAME">update</span><span class="WHIT"> </span><span class="PUNC">:</span><span class="WHIT"> </span><span class="KEYW">function</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="WHIT"> </span><span class="PUNC">{</span><span class="WHIT">
<span class='line'>315</span> </span><span class="WHIT">			</span><span class="NAME">this.currentTimeInMillis</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="KEYW">new</span><span class="WHIT"> </span><span class="NAME">Date</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">.</span><span class="NAME">getTime</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>316</span> </span><span class="WHIT">			</span><span class="NAME">this.elapsedTimeInMillis</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.currentTimeInMillis</span><span class="WHIT"> </span><span class="PUNC">-</span><span class="WHIT"> </span><span class="NAME">this.lastTimeInMillis</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>317</span> </span><span class="WHIT">			</span><span class="NAME">this.elapsedTimeInSeconds</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.elapsedTimeInMillis</span><span class="WHIT"> </span><span class="PUNC">/</span><span class="WHIT"> </span><span class="NUMB">1000.0</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>318</span> </span><span class="WHIT">			</span><span class="NAME">this.lastTimeInMillis</span><span class="WHIT"> </span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.currentTimeInMillis</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>319</span> </span><span class="WHIT">			</span><span class="NAME">this.accumTimeInMillis</span><span class="WHIT"> </span><span class="PUNC">+</span><span class="PUNC">=</span><span class="WHIT"> </span><span class="NAME">this.elapsedTimeInMillis</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>320</span> </span><span class="WHIT">		</span><span class="PUNC">}</span><span class="WHIT">
<span class='line'>321</span> </span><span class="WHIT">	</span><span class="PUNC">}</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>322</span> 
<span class='line'>323</span> </span><span class="WHIT">	</span><span class="COMM">// CocoonJS.FindAllNativeBindingsInCocoonJSExtensionObject = function(cocoonJSExtensionObject, nativeFunctionBindingCallback, nativeEventBindingCallback)</span><span class="WHIT">
<span class='line'>324</span> </span><span class="WHIT">	</span><span class="COMM">// {</span><span class="WHIT">
<span class='line'>325</span> </span><span class="WHIT">	</span><span class="COMM">// 	for (var cocoonJSExtensionObjectAttributeName in cocoonJSExtensionObject)</span><span class="WHIT">
<span class='line'>326</span> </span><span class="WHIT">	</span><span class="COMM">// 	{</span><span class="WHIT">
<span class='line'>327</span> </span><span class="WHIT">	</span><span class="COMM">// 		var cocoonJSExtensionObjectAttribute = cocoonJSExtensionObject[cocoonJSExtensionObjectAttributeName];</span><span class="WHIT">
<span class='line'>328</span> 
<span class='line'>329</span> </span><span class="WHIT">	</span><span class="COMM">// 		// Function</span><span class="WHIT">
<span class='line'>330</span> </span><span class="WHIT">	</span><span class="COMM">// 		if (typeof cocoonJSExtensionObjectAttribute === 'function' && typeof cocoonJSExtensionObjectAttribute.nativeFunctionName !== 'undefined')</span><span class="WHIT">
<span class='line'>331</span> </span><span class="WHIT">	</span><span class="COMM">// 		{</span><span class="WHIT">
<span class='line'>332</span> </span><span class="WHIT">	</span><span class="COMM">// 			var nativeFunctionName = cocoonJSExtensionObjectAttribute.nativeFunctionName;</span><span class="WHIT">
<span class='line'>333</span> </span><span class="WHIT">	</span><span class="COMM">// 			nativeFunctionBindingCallback(cocoonJSExtensionObjectAttributeName, nativeFunctionName);</span><span class="WHIT">
<span class='line'>334</span> </span><span class="WHIT">	</span><span class="COMM">// 		}</span><span class="WHIT">
<span class='line'>335</span> </span><span class="WHIT">	</span><span class="COMM">// 		// Event object</span><span class="WHIT">
<span class='line'>336</span> </span><span class="WHIT">	</span><span class="COMM">// 		else if (typeof cocoonJSExtensionObjectAttribute === 'object' && cocoonJSExtensionObjectAttribute !== null && typeof cocoonJSExtensionObjectAttribute.nativeEventName !== 'undefined')</span><span class="WHIT">
<span class='line'>337</span> </span><span class="WHIT">	</span><span class="COMM">// 		{</span><span class="WHIT">
<span class='line'>338</span> </span><span class="WHIT">	</span><span class="COMM">// 			var nativeEventName = cocoonJSExtensionObjectAttribute.nativeEventName;</span><span class="WHIT">
<span class='line'>339</span> </span><span class="WHIT">	</span><span class="COMM">// 			nativeEventBindingCallback(cocoonJSExtensionObjectAttributeName, nativeEventName);</span><span class="WHIT">
<span class='line'>340</span> </span><span class="WHIT">	</span><span class="COMM">// 		}</span><span class="WHIT">
<span class='line'>341</span> </span><span class="WHIT">	</span><span class="COMM">// 	}</span><span class="WHIT">
<span class='line'>342</span> </span><span class="WHIT">	</span><span class="COMM">// }</span><span class="WHIT">
<span class='line'>343</span> 
<span class='line'>344</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>345</span> 	This function looks for a CocoonJS extension object that is bound to the given native ext object name.
<span class='line'>346</span> 	@returns The CocoonJS extension object that corresponds to the give native extension object name or null if it cannot be found.
<span class='line'>347</span> 	*/</span><span class="WHIT">
<span class='line'>348</span> </span><span class="WHIT">	</span><span class="COMM">// CocoonJS.GetCocoonJSExtensionObjectForNativeExtensionObjectName = function(nativeExtensionObjectName)</span><span class="WHIT">
<span class='line'>349</span> </span><span class="WHIT">	</span><span class="COMM">// {</span><span class="WHIT">
<span class='line'>350</span> </span><span class="WHIT">	</span><span class="COMM">// 	var cocoonJSExtensionObject = null;</span><span class="WHIT">
<span class='line'>351</span> </span><span class="WHIT">	</span><span class="COMM">// 	// Look in the CocoonJS object and for every object that is a CocoonJS.Extension check if it's nativeExtensionObjectName matches to the one passed as argument. If so, create an object that will represent it's documentation for the native ext object.</span><span class="WHIT">
<span class='line'>352</span> </span><span class="WHIT">	</span><span class="COMM">// 	for (var cocoonJSAttributeName in CocoonJS)</span><span class="WHIT">
<span class='line'>353</span> </span><span class="WHIT">	</span><span class="COMM">// 	{</span><span class="WHIT">
<span class='line'>354</span> </span><span class="WHIT">	</span><span class="COMM">// 		var cocoonJSAttribute = CocoonJS[cocoonJSAttributeName];</span><span class="WHIT">
<span class='line'>355</span> </span><span class="WHIT">	</span><span class="COMM">// 		if (typeof cocoonJSAttribute === 'object' && cocoonJSAttribute instanceof CocoonJS.Extension && cocoonJSAttribute.nativeExtensionObjectName === nativeExtensionObjectName)</span><span class="WHIT">
<span class='line'>356</span> </span><span class="WHIT">	</span><span class="COMM">// 		{</span><span class="WHIT">
<span class='line'>357</span> </span><span class="WHIT">	</span><span class="COMM">// 			// We have found the CocoonJS object that represents the native ext extension object name. </span><span class="WHIT">
<span class='line'>358</span> </span><span class="WHIT">	</span><span class="COMM">// 			cocoonJSExtensionObject = cocoonJSAttribute;</span><span class="WHIT">
<span class='line'>359</span> </span><span class="WHIT">	</span><span class="COMM">// 			break;</span><span class="WHIT">
<span class='line'>360</span> </span><span class="WHIT">	</span><span class="COMM">// 		}</span><span class="WHIT">
<span class='line'>361</span> </span><span class="WHIT">	</span><span class="COMM">// 	}</span><span class="WHIT">
<span class='line'>362</span> </span><span class="WHIT">	</span><span class="COMM">// 	return cocoonJSExtensionObject;</span><span class="WHIT">
<span class='line'>363</span> </span><span class="WHIT">	</span><span class="COMM">// };</span><span class="WHIT">
<span class='line'>364</span> 
<span class='line'>365</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>366</span> 	This function adds functions to a CocoonJS extension object in order to bind them to the native makeCall function calls of the ext object.
<span class='line'>367</span> 
<span class='line'>368</span> 	@param extensionObject The reference to the CocoonJS extension object where to add the new functions bound to the ext object makeCall functions calls.
<span class='line'>369</span> 
<span class='line'>370</span> 	@param nativeFunctionsConfiguration An array of objects with the following structure:
<span class='line'>371</span> 
<span class='line'>372</span> 		{ nativeFunctionName : "" [, functionName : "", isAsync : true/false] }
<span class='line'>373</span> 
<span class='line'>374</span> 		- nativeFunctionName: Specifies the name of the function inside the ext object makeCall function call that will be bound.
<span class='line'>375</span> 		- functionName: An optional attribute that allows to specify the name of the function to be added to the CocoonJS extension object. If is not present, the name of the function will be the same
<span class='line'>376</span> 		as the nativeFunctionName.
<span class='line'>377</span> 		- isAsync: An optional attribute that allows to specify if the call should be performed using makeCall (false or missing) or makeCallAsync (true).
<span class='line'>378</span> 		- alternativeFunction: An optional attribute that allows to specify an alternative function that will be called internally when this function is called. This attribute
<span class='line'>379</span> 		allows for adding new functionalities like for example adding methods 
<span class='line'>380</span> 
<span class='line'>381</span> 	@returns The CocoonJS extension object.
<span class='line'>382</span> 	*/</span><span class="WHIT">
<span class='line'>383</span> </span><span class="WHIT">	</span><span class="COMM">// CocoonJS.AddNativeFunctionBindingsToExtensionObject = function(extensionObject, nativeFunctionsConfiguration)</span><span class="WHIT">
<span class='line'>384</span> </span><span class="WHIT">	</span><span class="COMM">// {</span><span class="WHIT">
<span class='line'>385</span> </span><span class="WHIT">	</span><span class="COMM">// 	if (typeof extensionObject === 'undefined' || extensionObject === null) throw("The passed extension object be a valid object.");</span><span class="WHIT">
<span class='line'>386</span> </span><span class="WHIT">	</span><span class="COMM">// 	if (typeof nativeFunctionsConfiguration === 'undefined' || nativeFunctionsConfiguration === null) throw("The passed native functions configuration array must be a valid object.");</span><span class="WHIT">
<span class='line'>387</span> 
<span class='line'>388</span> </span><span class="WHIT">	</span><span class="COMM">// 	for (var i = 0; i &lt; nativeFunctionsConfiguration.length; i++)</span><span class="WHIT">
<span class='line'>389</span> </span><span class="WHIT">	</span><span class="COMM">// 	{</span><span class="WHIT">
<span class='line'>390</span> </span><span class="WHIT">	</span><span class="COMM">// 		if (typeof nativeFunctionsConfiguration[i].nativeFunctionName === 'undefined') throw("The 'nativeFunctionName' attribute in the native function configuration object at index '" + i + "' in the native function configuration array cannot be undefined.");</span><span class="WHIT">
<span class='line'>391</span> </span><span class="WHIT">	</span><span class="COMM">// 		var nativeFunctionName = nativeFunctionsConfiguration[i].nativeFunctionName;</span><span class="WHIT">
<span class='line'>392</span> </span><span class="WHIT">	</span><span class="COMM">// 		var functionName = typeof nativeFunctionsConfiguration[i].functionName !== 'undefined' ? nativeFunctionsConfiguration[i].functionName : nativeFunctionName;</span><span class="WHIT">
<span class='line'>393</span> </span><span class="WHIT">	</span><span class="COMM">// 		var makeCallFunction = null;</span><span class="WHIT">
<span class='line'>394</span> </span><span class="WHIT">	</span><span class="COMM">// 		makeCallFunction = typeof nativeFunctionsConfiguration[i].isAsync !== 'undefined' && nativeFunctionsConfiguration[i].isAsync ? extensionObject.nativeExtensionObject.makeCallAsync : extensionObject.nativeExtensionObject.makeCall;</span><span class="WHIT">
<span class='line'>395</span> </span><span class="WHIT">	</span><span class="COMM">// 		// Add the new function to the CocoonJS extension object</span><span class="WHIT">
<span class='line'>396</span> </span><span class="WHIT">	</span><span class="COMM">// 		extensionObject[functionName] = function()</span><span class="WHIT">
<span class='line'>397</span> </span><span class="WHIT">	</span><span class="COMM">// 		{</span><span class="WHIT">
<span class='line'>398</span> </span><span class="WHIT">	</span><span class="COMM">// 			// Convert the arguments object to an array</span><span class="WHIT">
<span class='line'>399</span> </span><span class="WHIT">	</span><span class="COMM">// 			var arguments = Array.prototype.slice.call(arguments);</span><span class="WHIT">
<span class='line'>400</span> </span><span class="WHIT">	</span><span class="COMM">// 			// Add the native function name as the first parameter</span><span class="WHIT">
<span class='line'>401</span> </span><span class="WHIT">	</span><span class="COMM">// 			arguments.unshift(nativeFunctionName);</span><span class="WHIT">
<span class='line'>402</span> </span><span class="WHIT">	</span><span class="COMM">// 			// Make the native ext object call</span><span class="WHIT">
<span class='line'>403</span> </span><span class="WHIT">	</span><span class="COMM">// 			var result = makeCallFunction.apply(extensionObject.nativeExtensionObject, arguments);</span><span class="WHIT">
<span class='line'>404</span> </span><span class="WHIT">	</span><span class="COMM">// 			return result;</span><span class="WHIT">
<span class='line'>405</span> </span><span class="WHIT">	</span><span class="COMM">// 		}</span><span class="WHIT">
<span class='line'>406</span> </span><span class="WHIT">	</span><span class="COMM">// 		// Add a property to the newly added function to store the name of the original function.</span><span class="WHIT">
<span class='line'>407</span> </span><span class="WHIT">	</span><span class="COMM">// 		extensionObject[functionName].nativeFunctionName = nativeFunctionName;</span><span class="WHIT">
<span class='line'>408</span> </span><span class="WHIT">	</span><span class="COMM">// 	}</span><span class="WHIT">
<span class='line'>409</span> </span><span class="WHIT">	</span><span class="COMM">// 	return extensionObject;</span><span class="WHIT">
<span class='line'>410</span> </span><span class="WHIT">	</span><span class="COMM">// };</span><span class="WHIT">
<span class='line'>411</span> 
<span class='line'>412</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>413</span> 	This function adds objects to a CocoonJS extension object to allow event listener handling (add and remove) bound to the native ext object event listener handling.
<span class='line'>414</span> 
<span class='line'>415</span> 	@param extensionObject The reference to the CocoonJS extension object where to add the new objects bound to the ext object event listener handling.
<span class='line'>416</span> 
<span class='line'>417</span> 	@param nativeEventsConfiguration An array of objects with the following structure:
<span class='line'>418</span> 
<span class='line'>419</span> 		{ nativeEventName : "" [, eventObjectName : ""] }
<span class='line'>420</span> 
<span class='line'>421</span> 		- nativeEventName: Specifies the event in the native ext object to be bound.
<span class='line'>422</span> 		- eventObjectName: An optional attribute that allows to specify the name of the object to be added to the CocoonJS extension object. If is not present, the name of the function will be the same
<span class='line'>423</span> 		as the nativeEventName.
<span class='line'>424</span> 		- alternativeAddEventListenerFunction:
<span class='line'>425</span> 		- alternativeRemoveEventListenerFunction:
<span class='line'>426</span> 
<span class='line'>427</span> 	@returns The CocoonJS extension object.
<span class='line'>428</span> 	*/</span><span class="WHIT">
<span class='line'>429</span> </span><span class="WHIT">	</span><span class="COMM">// CocoonJS.AddNativeEventBindingsToExtensionObject = function(extensionObject, nativeEventsConfiguration)</span><span class="WHIT">
<span class='line'>430</span> </span><span class="WHIT">	</span><span class="COMM">// {</span><span class="WHIT">
<span class='line'>431</span> </span><span class="WHIT">	</span><span class="COMM">// 	if (typeof extensionObject === 'undefined' || extensionObject === null) throw("The passed extension object be a valid object.");</span><span class="WHIT">
<span class='line'>432</span> </span><span class="WHIT">	</span><span class="COMM">// 	if (typeof nativeEventsConfiguration === 'undefined' || nativeEventsConfiguration === null) throw("The passed native events configuration array must be a valid object.");</span><span class="WHIT">
<span class='line'>433</span> 
<span class='line'>434</span> </span><span class="WHIT">	</span><span class="COMM">// 	for (var i = 0; i &lt; nativeEventsConfiguration.length; i++)</span><span class="WHIT">
<span class='line'>435</span> </span><span class="WHIT">	</span><span class="COMM">// 	{</span><span class="WHIT">
<span class='line'>436</span> </span><span class="WHIT">	</span><span class="COMM">// 		if (typeof nativeEventsConfiguration[i].nativeEventName === 'undefined') throw("The 'nativeEventName' attribute in the native event configuration object at index '" + i + "' in the native event configuration array cannot be undefined.");</span><span class="WHIT">
<span class='line'>437</span> </span><span class="WHIT">	</span><span class="COMM">// 		var nativeEventName = nativeEventsConfiguration[i].nativeEventName;</span><span class="WHIT">
<span class='line'>438</span> </span><span class="WHIT">	</span><span class="COMM">// 		var eventObjectName = typeof nativeEventsConfiguration[i].eventObjectName !== 'undefined' ? nativeEventsConfiguration[i].eventObjectName : nativeEventName;</span><span class="WHIT">
<span class='line'>439</span> </span><span class="WHIT">	</span><span class="COMM">// 		// Anonymous function call so each variable in the loop is used in the event listener handling function bindings.</span><span class="WHIT">
<span class='line'>440</span> </span><span class="WHIT">	</span><span class="COMM">// 		(function(nativeEventName, eventObjectName)</span><span class="WHIT">
<span class='line'>441</span> </span><span class="WHIT">	</span><span class="COMM">// 		{</span><span class="WHIT">
<span class='line'>442</span> </span><span class="WHIT">	</span><span class="COMM">//     		extensionObject[eventObjectName] =</span><span class="WHIT">
<span class='line'>443</span> </span><span class="WHIT">	</span><span class="COMM">//     		{</span><span class="WHIT">
<span class='line'>444</span> </span><span class="WHIT">	</span><span class="COMM">//     			// Store the native event name</span><span class="WHIT">
<span class='line'>445</span> </span><span class="WHIT">	</span><span class="COMM">//     			nativeEventName : nativeEventName,</span><span class="WHIT">
<span class='line'>446</span> </span><span class="WHIT">	</span><span class="COMM">//     			// Create the event listener management functions bound to the native counterparts</span><span class="WHIT">
<span class='line'>447</span> </span><span class="WHIT">	</span><span class="COMM">//     			addEventListener : function(callback)</span><span class="WHIT">
<span class='line'>448</span> </span><span class="WHIT">	</span><span class="COMM">// 	    		{</span><span class="WHIT">
<span class='line'>449</span> </span><span class="WHIT">	</span><span class="COMM">// 	    			extensionObject.nativeExtensionObject.addEventListener(nativeEventName, callback);</span><span class="WHIT">
<span class='line'>450</span> </span><span class="WHIT">	</span><span class="COMM">//     			},</span><span class="WHIT">
<span class='line'>451</span> </span><span class="WHIT">	</span><span class="COMM">//     			removeEventListener : function(callback)</span><span class="WHIT">
<span class='line'>452</span> </span><span class="WHIT">	</span><span class="COMM">//     			{</span><span class="WHIT">
<span class='line'>453</span> </span><span class="WHIT">	</span><span class="COMM">// 	    			extensionObject.nativeExtensionObject.removeEventListener(nativeEventName, callback);</span><span class="WHIT">
<span class='line'>454</span> </span><span class="WHIT">	</span><span class="COMM">//     			}</span><span class="WHIT">
<span class='line'>455</span> </span><span class="WHIT">	</span><span class="COMM">//     			// ,</span><span class="WHIT">
<span class='line'>456</span> </span><span class="WHIT">	</span><span class="COMM">//     			// removeAllEventListeners : function()</span><span class="WHIT">
<span class='line'>457</span> </span><span class="WHIT">	</span><span class="COMM">//     			// {</span><span class="WHIT">
<span class='line'>458</span> 
<span class='line'>459</span> </span><span class="WHIT">	</span><span class="COMM">//     			// }</span><span class="WHIT">
<span class='line'>460</span> </span><span class="WHIT">	</span><span class="COMM">//     		};</span><span class="WHIT">
<span class='line'>461</span> </span><span class="WHIT">	</span><span class="COMM">// 		})(nativeEventName, eventObjectName);</span><span class="WHIT">
<span class='line'>462</span> </span><span class="WHIT">	</span><span class="COMM">// 	}</span><span class="WHIT">
<span class='line'>463</span> </span><span class="WHIT">	</span><span class="COMM">// 	return extensionObject;</span><span class="WHIT">
<span class='line'>464</span> </span><span class="WHIT">	</span><span class="COMM">// };</span><span class="WHIT">
<span class='line'>465</span> 
<span class='line'>466</span> </span><span class="WHIT">	</span><span class="COMM">/**
<span class='line'>467</span> 	The function object constructor function all the CocoonJS extensions can use to instantiate the CocoonJS extension object and add all the functionality needed bound to the native ext object.
<span class='line'>468</span> 
<span class='line'>469</span> 	@param nativeExtensionObject The reference to the ext object extension object.
<span class='line'>470</span> 
<span class='line'>471</span> 	@param nativeFunctionsConfiguration See CocoonJS.AddNativeFunctionBindingsToExtensionObject function's documentation for more details.
<span class='line'>472</span> 
<span class='line'>473</span> 	@param nativeEventsConfiguration See CocoonJS.AddNativeEventBindingsToExtensionObject function's documentation for more details.
<span class='line'>474</span> 
<span class='line'>475</span> 	@returns The new CocoonJS extension object.
<span class='line'>476</span> 	*/</span><span class="WHIT">
<span class='line'>477</span> </span><span class="WHIT">	</span><span class="COMM">// CocoonJS.Extension = function(nativeExtensionObjectName, nativeFunctionsConfiguration, nativeEventsConfiguration)</span><span class="WHIT">
<span class='line'>478</span> </span><span class="WHIT">	</span><span class="COMM">// {</span><span class="WHIT">
<span class='line'>479</span> </span><span class="WHIT">	</span><span class="COMM">// 	if (typeof nativeExtensionObjectName === 'undefined' || nativeExtensionObjectName === null) throw("The native extension object name cannot be null");</span><span class="WHIT">
<span class='line'>480</span> 
<span class='line'>481</span> </span><span class="WHIT">	</span><span class="COMM">// 	if (window.ext[nativeExtensionObjectName] === 'undefined') throw("The given native extension object name '" + nativeExtensionObjectName + "' is incorrect or the native extension object is undefined.");</span><span class="WHIT">
<span class='line'>482</span> 
<span class='line'>483</span> </span><span class="WHIT">	</span><span class="COMM">// 	var nativeExtensionObject = window.ext[nativeExtensionObjectName];</span><span class="WHIT">
<span class='line'>484</span> 
<span class='line'>485</span> </span><span class="WHIT">	</span><span class="COMM">// 	// Store a reference to the native extension object and to it's name</span><span class="WHIT">
<span class='line'>486</span> </span><span class="WHIT">	</span><span class="COMM">// 	this.nativeExtensionObject = nativeExtensionObject;</span><span class="WHIT">
<span class='line'>487</span> </span><span class="WHIT">	</span><span class="COMM">// 	this.nativeExtensionObjectName = nativeExtensionObjectName;</span><span class="WHIT">
<span class='line'>488</span> 
<span class='line'>489</span> </span><span class="WHIT">	</span><span class="COMM">// 	// If native function configuration is passed, use it to add some functions to the new extension object.</span><span class="WHIT">
<span class='line'>490</span> </span><span class="WHIT">	</span><span class="COMM">// 	if (typeof nativeFunctionsConfiguration !== 'undefined')</span><span class="WHIT">
<span class='line'>491</span> </span><span class="WHIT">	</span><span class="COMM">// 	{</span><span class="WHIT">
<span class='line'>492</span> </span><span class="WHIT">	</span><span class="COMM">// 		CocoonJS.AddNativeFunctionBindingsToExtensionObject(this, nativeFunctionsConfiguration);</span><span class="WHIT">
<span class='line'>493</span> </span><span class="WHIT">	</span><span class="COMM">// 	}</span><span class="WHIT">
<span class='line'>494</span> 
<span class='line'>495</span> </span><span class="WHIT">	</span><span class="COMM">// 	// If native event configuration is passed, use it to add some event objects to the new extension object.</span><span class="WHIT">
<span class='line'>496</span> </span><span class="WHIT">	</span><span class="COMM">// 	if (typeof nativeEventsConfiguration !== 'undefined')</span><span class="WHIT">
<span class='line'>497</span> </span><span class="WHIT">	</span><span class="COMM">// 	{</span><span class="WHIT">
<span class='line'>498</span> </span><span class="WHIT">	</span><span class="COMM">// 		CocoonJS.AddNativeEventBindingsToExtensionObject(this, nativeEventsConfiguration);</span><span class="WHIT">
<span class='line'>499</span> </span><span class="WHIT">	</span><span class="COMM">// 	}</span><span class="WHIT">
<span class='line'>500</span> 
<span class='line'>501</span> </span><span class="WHIT">	</span><span class="COMM">// 	return this;</span><span class="WHIT">
<span class='line'>502</span> </span><span class="WHIT">	</span><span class="COMM">// };   </span><span class="WHIT">
<span class='line'>503</span> 
<span class='line'>504</span> </span><span class="PUNC">}</span><span class="PUNC">)</span><span class="PUNC">(</span><span class="PUNC">)</span><span class="PUNC">;</span><span class="WHIT">
<span class='line'>505</span> 
<span class='line'>506</span> </span><span class="WHIT">	</span></pre></body></html>